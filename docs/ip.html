<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>la préparation de l’image | La raport intermédiaire</title>
  <meta name="description" content="la préparation de l’image | La raport intermédiaire" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="la préparation de l’image | La raport intermédiaire" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="la préparation de l’image | La raport intermédiaire" />
  
  
  

<meta name="author" content="Antoine Viguié, Aymane Berriane, Christian Alvarez Leon, Meng Wang, Yu PENG" />


<meta name="date" content="2021-02-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="piv.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<div><img src="images/ecole.png" width="200" alt="POLYTECH NICE-SOPHIA" hspace="30" vspace="30"/></div>
<li><a href="./"><li>Projet d'Ingénierie:LSPIV</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="ip.html"><a href="ip.html"><i class="fa fa-check"></i>la préparation de l’image</a>
<ul>
<li class="chapter" data-level="" data-path="ip.html"><a href="ip.html#la-correction-de-distorsion-optique"><i class="fa fa-check"></i>La correction de distorsion optique</a></li>
<li class="chapter" data-level="" data-path="ip.html"><a href="ip.html#lorthorectification"><i class="fa fa-check"></i>l’orthorectification</a></li>
<li class="chapter" data-level="" data-path="ip.html"><a href="ip.html#la-mise-en-niveau-de-gris-et-la-correction-du-gamma-et-du-contraste."><i class="fa fa-check"></i>La mise en niveau de gris et la correction du gamma et du contraste.</a></li>
<li class="chapter" data-level="" data-path="ip.html"><a href="ip.html#pour-tous-les-images"><i class="fa fa-check"></i>Pour tous les images</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="piv.html"><a href="piv.html"><i class="fa fa-check"></i>le traitement PIV</a></li>
<li class="chapter" data-level="" data-path="ad.html"><a href="ad.html"><i class="fa fa-check"></i>l’analyse des donnée</a>
<ul>
<li class="chapter" data-level="" data-path="ad.html"><a href="ad.html#résultats-non-traités"><i class="fa fa-check"></i>Résultats non traités</a></li>
<li class="chapter" data-level="" data-path="ad.html"><a href="ad.html#filtrage"><i class="fa fa-check"></i>Filtrage</a></li>
<li class="chapter" data-level="" data-path="ad.html"><a href="ad.html#substitution"><i class="fa fa-check"></i>Substitution</a></li>
<li class="chapter" data-level="" data-path="ad.html"><a href="ad.html#estimation-de-décharge"><i class="fa fa-check"></i>Estimation de décharge</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>REFERENCES</a></li>
<li class="divider"></li>
<li><a href="https://univ-cotedazur.fr/"><li>POLYTECH NICE-SOPHIA</a></li>   

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">La raport intermédiaire</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ip" class="section level1 unnumbered">
<h1>la préparation de l’image</h1>
<p>La préparation de l’image est nécessaire pour être en mesure de mieux distinguer les motifs en mouvement de l’imagerie et de supprimer les effets de perspective de l’image. La manipulation d’image pour préparer l’imagerie pour l’analyse LSPIV se composent de plusieurs étapes. Subséquemment, ces étapes sont:</p>
<ol style="list-style-type: decimal">
<li><p>La correction de distorsion optique.</p></li>
<li><p>l’orthorectification.</p></li>
<li><p>La mise en niveau de gris et la correction du gamma et du contraste.</p></li>
</ol>
<p>Les deux premières étapes
sont appliquées pour garantir la présence de distances égales dans les images.
La troisième étape est utilisée pour améliorer la distinction de la graine de
l’arrière-plan et donc s’assurer de la validation de similitude
processus est efficace.</p>
<p>Dans cette partie, on va utiliser la libraire de python Opencv3<span class="citation">(<a href="references.html#ref-noauthor_opencv_2015" role="doc-biblioref"><span>“<span>OpenCV</span> 3.0. <span>OpenCV</span>”</span> 2015</a>)</span> qui nous permette d’appliquer des options de manipulation d’images et le vidéo. vous pouvez l’installer par cette ligne de commande.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="ip.html#cb1-1" aria-hidden="true" tabindex="-1"></a>pip install opencv<span class="op">-</span>python</span></code></pre></div>
<p>On a aussi besoin d’autres libraires python numpy, pandas, math pour traiter des données . Et si vous voulez refaire cette étude sur vos ordinateurs, On vous conseille d’utiliser le python installé de site Anaconda et jupyter notebook</p>
<div id="la-correction-de-distorsion-optique" class="section level2 unnumbered">
<h2>La correction de distorsion optique</h2>
<p>En raison de la la courbure des lentilles de l’appareil photo, les images peuvent être déformées. Figure <a href="ip.html#fig:flens">1</a> présente les deux types de distorsions des lentilles les plus fréquentes,la distorsion en barillet et la distorsion en coussinet <span class="citation">(<a href="references.html#ref-fryer_lens_1986" role="doc-biblioref">Fryer and Brown 1986</a>)</span> , Ces distorsions géométriques sont liées à des facteurs radiaux. Un troisième type de distorsion est distorsion tangentielle, qui se produit lorsque les lentilles ne sont pas parallèles au plan
image. Certaines caméras sont capables de faire face à ces distorsions
intérieurement. Cependant, la plupart du temps, une certaine quantité de post-traitement est
nécessaire pour ajuster les images.</p>

<div class="figure"><span id="fig:flens"></span>
<img src="images/lens.png" alt="Les differentes types de distortion. Du gauche à la droit : la grille d’origine, la distorsion en barillet et la distorsion en coussinet." width="100%"  />
<p class="caption">
Figure 1: Les differentes types de distortion. Du gauche à la droit : la grille d’origine, la distorsion en barillet et la distorsion en coussinet.
</p>
</div>
<p>Les formules suivantes sont appliquées pour supprimer la distortion radial (Voir Équation<a href="ip.html#eq:corr1">(1)</a>) et la distorsion tangentielle (Voir Équation<a href="ip.html#eq:corr2">(2)</a>)</p>
<span class="math display" id="eq:corr1">\[\begin{equation}
\begin{aligned}
  x_{corr} = x\left(1+k_1r^2+k_2r^4+k_3r^6\right)
  \\y_{corr} = y\left(1+k_1r^2+k_2r^4+k_3r^6\right)
\end{aligned}
 \tag{1}
\end{equation}\]</span>
<p>D’où <span class="math inline">\(𝑥\)</span> et <span class="math inline">\(𝑦\)</span> sont les coordonnées d’origine; <span class="math inline">\(x_{𝑐𝑜𝑟𝑟}\)</span> et
<span class="math inline">\(y_{𝑐𝑜𝑟𝑟}\)</span> sont les coordonnées corrigés. <span class="math inline">\(𝑟\)</span> est la distance entre le
point <span class="math inline">\(\left(𝑥, 𝑦\right)\)</span> et le centre de la distortion. <span class="math inline">\(𝑘_1\)</span>, <span class="math inline">\(𝑘_2\)</span>,
et <span class="math inline">\(𝑘_3\)</span> sont les coefficients radiales. Pour la distortion en barillet et la distortion en coussinet , <span class="math inline">\(𝑘_1\)</span> est respectivemen negative et positive. <span class="math inline">\(𝑘_2\)</span> et <span class="math inline">\(𝑘_3\)</span> sont négligeables.</p>
<span class="math display" id="eq:corr2">\[\begin{equation}
\begin{aligned}
   x_{corr} = x+\left[ 2 p_1 x y+ p_2\left( r^2+2x^2\right) \right]\\
  y_{corr} = y+\left[ p_1 \left(r^2+2 y^2\right)+ 2p_2xy\right]
\end{aligned}
 \tag{2}
\end{equation}\]</span>
<p>D’où <span class="math inline">\(𝑝_1\)</span> et <span class="math inline">\(𝑝_2\)</span> sont les coefficient de la distortion tangentielle. les différents coefficients sont souvent stockés dans un tableau:</p>
<span class="math display">\[\begin{equation}
C_{dis}=
\begin{bmatrix}
k_1 &amp; k_2 &amp; p_1 &amp; p_2 &amp; k_3
\end{bmatrix}
\end{equation}\]</span>
<p>À part du coefficient de distorsion, pour pouvoir corriger l’imagerie, Une conversion entre les coordonnées de distorsion et la résolution de la caméra est
fait. Pour cela, la formule est donnée dans l’équation <a href="ip.html#eq:corr3">(3)</a></p>
<span class="math display" id="eq:corr3">\[\begin{equation}
\begin{bmatrix}
x\\
y\\
w
\end{bmatrix}
= M_{con} \cdot
\begin{bmatrix}
x\\
y\\
z
\end{bmatrix}
\quad \text{d&#39;où} \quad
M_{con} =
\begin{bmatrix}
f_x &amp; 0 &amp; c_x\\
0 &amp; f_y &amp; c_y\\
0 &amp; 0 &amp;1
\end{bmatrix}
\tag{3}
\end{equation}\]</span>
<p>D’où <span class="math inline">\([𝑥, 𝑦, 𝑤]\)</span> sont les coordonnées d’image homogène 2D et <span class="math inline">\([x, y , z]\)</span> sont les coordonnées de caméra 3D . <span class="math inline">\(f_𝑥\)</span> et <span class="math inline">\(𝑓_𝑦\)</span> sont les longueurs locales de la caméra dans le sens <span class="math inline">\(𝑥\)</span> et <span class="math inline">\(𝑦\)</span> ,en genéral, ils sont identiques <span class="math inline">\(𝑐_𝑥\)</span> et <span class="math inline">\(𝑐_𝑦\)</span> sont les coordinations de centre optique de la caméra dans le sens <span class="math inline">\(𝑥\)</span> et <span class="math inline">\(𝑦\)</span>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="ip.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="ip.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="ip.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-3"><a href="ip.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-4"><a href="ip.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-5"><a href="ip.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="ip.html#cb4-1" aria-hidden="true" tabindex="-1"></a>dir_video <span class="op">=</span> <span class="st">&#39;Python/example_video.mp4&#39;</span></span>
<span id="cb4-2"><a href="ip.html#cb4-2" aria-hidden="true" tabindex="-1"></a>dir_saves <span class="op">=</span> <span class="st">&#39;Python/frames&#39;</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="ip.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(dir_saves):</span>
<span id="cb5-2"><a href="ip.html#cb5-2" aria-hidden="true" tabindex="-1"></a>    os.mkdir(dir_saves)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="ip.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># définition de correction de la distorsion </span></span>
<span id="cb6-2"><a href="ip.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lens_corr(img, k1<span class="op">=-</span><span class="fl">10.0e-6</span>, c<span class="op">=</span><span class="dv">2</span>, f<span class="op">=</span><span class="fl">8.0</span>):</span>
<span id="cb6-3"><a href="ip.html#cb6-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb6-4"><a href="ip.html#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># définition la caractère de l&#39;image </span></span>
<span id="cb6-5"><a href="ip.html#cb6-5" aria-hidden="true" tabindex="-1"></a>    height, width, __ <span class="op">=</span> img.shape</span>
<span id="cb6-6"><a href="ip.html#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="ip.html#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># le vecteur de coefficient de distorsion</span></span>
<span id="cb6-8"><a href="ip.html#cb6-8" aria-hidden="true" tabindex="-1"></a>    dist <span class="op">=</span> np.zeros((<span class="dv">5</span>,<span class="dv">1</span>),np.float64)</span>
<span id="cb6-9"><a href="ip.html#cb6-9" aria-hidden="true" tabindex="-1"></a>    dist[<span class="dv">0</span>,<span class="dv">0</span>] <span class="op">=</span> k1</span>
<span id="cb6-10"><a href="ip.html#cb6-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-11"><a href="ip.html#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># la matrice du caméra</span></span>
<span id="cb6-12"><a href="ip.html#cb6-12" aria-hidden="true" tabindex="-1"></a>    mtx <span class="op">=</span> np.eye(<span class="dv">3</span>,dtype<span class="op">=</span>np.float32)</span>
<span id="cb6-13"><a href="ip.html#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="ip.html#cb6-14" aria-hidden="true" tabindex="-1"></a>    mtx[<span class="dv">0</span>,<span class="dv">2</span>] <span class="op">=</span> width<span class="op">/</span>c     <span class="co"># centre x</span></span>
<span id="cb6-15"><a href="ip.html#cb6-15" aria-hidden="true" tabindex="-1"></a>    mtx[<span class="dv">1</span>,<span class="dv">2</span>] <span class="op">=</span> height<span class="op">/</span>c    <span class="co"># centre y</span></span>
<span id="cb6-16"><a href="ip.html#cb6-16" aria-hidden="true" tabindex="-1"></a>    mtx[<span class="dv">0</span>,<span class="dv">0</span>] <span class="op">=</span> f           <span class="co"># la distance focale x</span></span>
<span id="cb6-17"><a href="ip.html#cb6-17" aria-hidden="true" tabindex="-1"></a>    mtx[<span class="dv">1</span>,<span class="dv">1</span>] <span class="op">=</span> f           <span class="co"># la distance focale y</span></span>
<span id="cb6-18"><a href="ip.html#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="ip.html#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># la correction d&#39;image par la distorsion</span></span>
<span id="cb6-20"><a href="ip.html#cb6-20" aria-hidden="true" tabindex="-1"></a>    corr_img <span class="op">=</span> cv2.undistort(img, mtx, dist)</span>
<span id="cb6-21"><a href="ip.html#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="ip.html#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> corr_img</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="ip.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pour localiser les GCPts dans les images:</span></span>
<span id="cb7-2"><a href="ip.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># importer la vidéo et corriger la première image pour la distorsion de l&#39;objectif</span></span>
<span id="cb7-3"><a href="ip.html#cb7-3" aria-hidden="true" tabindex="-1"></a>cap <span class="op">=</span> cv2.VideoCapture(dir_video)</span>
<span id="cb7-4"><a href="ip.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cap.isOpened():</span>
<span id="cb7-5"><a href="ip.html#cb7-5" aria-hidden="true" tabindex="-1"></a>    ret, img <span class="op">=</span> cap.read()</span>
<span id="cb7-6"><a href="ip.html#cb7-6" aria-hidden="true" tabindex="-1"></a>    corr_img <span class="op">=</span> lens_corr(img, k1<span class="op">=-</span><span class="fl">10.0e-6</span>, c<span class="op">=</span><span class="dv">2</span>, f<span class="op">=</span><span class="fl">8.0</span>)</span>
<span id="cb7-7"><a href="ip.html#cb7-7" aria-hidden="true" tabindex="-1"></a>cap.release()</span>
<span id="cb7-8"><a href="ip.html#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="ip.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># afficher l&#39;image corrigée et les emplacements des GCP</span></span>
<span id="cb7-10"><a href="ip.html#cb7-10" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">5</span>))</span>
<span id="cb7-11"><a href="ip.html#cb7-11" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left<span class="op">=</span><span class="dv">0</span>, bottom<span class="op">=</span><span class="dv">0</span>, right<span class="op">=</span><span class="dv">1</span>, top<span class="op">=</span><span class="dv">1</span>, wspace<span class="op">=</span><span class="fl">0.1</span>, hspace<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-12"><a href="ip.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># [:,:,::-1] BGR =&gt; RGB ; Dans opencv c&#39;est BGR</span></span>
<span id="cb7-13"><a href="ip.html#cb7-13" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb7-14"><a href="ip.html#cb7-14" aria-hidden="true" tabindex="-1"></a>plt.imshow(img[:,:,::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb7-15"><a href="ip.html#cb7-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;AVANT&#39;</span>)</span>
<span id="cb7-16"><a href="ip.html#cb7-16" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>) </span></code></pre></div>
<pre><code>## (-0.5, 1919.5, 1079.5, -0.5)</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="ip.html#cb9-1" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb9-2"><a href="ip.html#cb9-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(corr_img[:,:,::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb9-3"><a href="ip.html#cb9-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;APRÈS&#39;</span>)</span>
<span id="cb9-4"><a href="ip.html#cb9-4" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>) </span></code></pre></div>
<pre><code>## (-0.5, 1919.5, 1079.5, -0.5)</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="ip.html#cb11-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-8"></span>
<img src="PROJET_LSPIV_files/figure-html/unnamed-chunk-8-1.png" alt="La correction de distorsion optique" width="100%"  />
<p class="caption">
Figure 2: La correction de distorsion optique
</p>
</div>
</div>
<div id="lorthorectification" class="section level2 unnumbered">
<h2>l’orthorectification</h2>
<p>Pour supprimer les effets de la perspective de l’image ,( où les objets sont plus proches
de la caméra semble être plus grande dans l’image) ,l’orthorectification est appliquée.
Lors de l’application d’orthorectification,le système de coordonnées de l’imagerie est transféré à une système de coordonnée locale. Pour ce système de coordonnées locales, points de contrôle au sol (GCP) sont
mis en place à côté du flux sont utilisés. Pour l’orthorectification
processus pour être aussi précis que possible, au moins quatre GCP sont nécessaires, si
les images sont capturées perpendiculairement au flux ou lorsque les GCP
sont placés au même niveau que le niveau de l’eau. Un minimum de six
GCP sont nécessaires lorsque les GCP ne sont pas placés dans le même plan que le
niveau d’eau. Sur la Figure <a href="ip.html#fig:fortho">3</a> les différents sites de jaugeage
et les configurations sont affichées.</p>

<div class="figure"><span id="fig:fortho"></span>
<img src="images/ortho.png" alt="Nombre de points de contrôle au sol (GCP) nécessaires dans différentes circonstances.(source: Flood wave monitoring using LSPIV)" width="100%"  />
<p class="caption">
Figure 3: Nombre de points de contrôle au sol (GCP) nécessaires dans différentes circonstances.(source: Flood wave monitoring using LSPIV)
</p>
</div>
<p>Lors de l’utilisation de quatre GCP, les facteurs d’inversion <span class="math inline">\(𝑓_𝑥\)</span> et <span class="math inline">\(𝑓_𝑦\)</span> sont
déterminé en utilisant la formule indiquée dans l’équation <a href="ip.html#eq:corr4">(4)</a>.</p>
<span class="math display" id="eq:corr4">\[\begin{equation}
p_{loc}\left(x,y\right)=p_{img}\left(f_x\left(x,y\right), f_y\left(x,y\right)\right)
\tag{4}
\end{equation}\]</span>
<p>D’où <span class="math inline">\(𝑝_ {𝑑𝑠𝑡} \left (𝑥, 𝑦, 𝑧 \right)\)</span> est l’emplacement géographique du
point de contrôle au sol dans le système de coordonnées local, généralement en métrique
units; <span class="math inline">\(𝑝_ {𝑠𝑟𝑐} \left (𝑥, 𝑦 \right)\)</span> est la coordonnée xy du sol
point de contrôle dans l’imagerie, généralement en pixels; et <span class="math inline">\(𝑓_𝑥\)</span> et <span class="math inline">\(𝑓_𝑦\)</span> le
facteurs d’inversion.</p>
<p>Simultanément à ce processus, la résolution de l’image peut être réglée
en multipliant les coordonnées <span class="math inline">\(𝐺𝐶𝑃_ {𝑑𝑠𝑡} \left (𝑥, 𝑦 \right)\)</span> par les
pixels souhaités par coefficient de mètre.</p>
<p>Lorsque six (ou plus) GCP sont utilisés - parce que les coordonnées en trois dimensions
pour les GCP sont nécessaires - un modèle de sténopé peut être utilisé. Cette méthode est
expliqué par <span class="citation">(<a href="references.html#ref-jodeau_application_2008" role="doc-biblioref">Jodeau et al. 2008</a>)</span></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="ip.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Emplacements des GCPs dans les images (pixels)</span></span>
<span id="cb12-2"><a href="ip.html#cb12-2" aria-hidden="true" tabindex="-1"></a>data_from <span class="op">=</span> {<span class="st">&#39;x&#39;</span>: [<span class="dv">992</span>, <span class="dv">1545</span>, <span class="dv">1773</span>,  <span class="dv">943</span>],</span>
<span id="cb12-3"><a href="ip.html#cb12-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;y&#39;</span>: [<span class="dv">366</span>,  <span class="dv">403</span>,  <span class="dv">773</span>,  <span class="dv">724</span>]}</span>
<span id="cb12-4"><a href="ip.html#cb12-4" aria-hidden="true" tabindex="-1"></a>df_from <span class="op">=</span> pd.DataFrame(data_from)</span>
<span id="cb12-5"><a href="ip.html#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="ip.html#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="ip.html#cb12-7" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">4</span>))</span>
<span id="cb12-8"><a href="ip.html#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">111</span>)</span>
<span id="cb12-9"><a href="ip.html#cb12-9" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left<span class="op">=</span><span class="dv">0</span>, bottom<span class="op">=</span><span class="dv">0</span>, right<span class="op">=</span><span class="dv">1</span>, top<span class="op">=</span><span class="dv">1</span>, wspace<span class="op">=</span><span class="fl">0.1</span>, hspace<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb12-10"><a href="ip.html#cb12-10" aria-hidden="true" tabindex="-1"></a>plt.imshow(corr_img[:,:,::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb12-11"><a href="ip.html#cb12-11" aria-hidden="true" tabindex="-1"></a>plt.plot(df_from.x, df_from.y ,<span class="st">&#39;r.&#39;</span>)</span>
<span id="cb12-12"><a href="ip.html#cb12-12" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>)</span></code></pre></div>
<pre><code>## (-0.5, 1919.5, 1079.5, -0.5)</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="ip.html#cb14-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-9"></span>
<img src="PROJET_LSPIV_files/figure-html/unnamed-chunk-9-1.png" alt="Les localisations des GRPS" width="100%"  />
<p class="caption">
Figure 4: Les localisations des GRPS
</p>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="ip.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Emplacements des GCPs dans le système de coordonnées local (mètres)</span></span>
<span id="cb15-2"><a href="ip.html#cb15-2" aria-hidden="true" tabindex="-1"></a>data_to <span class="op">=</span> {<span class="st">&#39;x&#39;</span>: [ <span class="fl">0.25</span>, <span class="fl">4.25</span>, <span class="fl">4.50</span>, <span class="fl">0.00</span>],</span>
<span id="cb15-3"><a href="ip.html#cb15-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;y&#39;</span>: [ <span class="fl">0.30</span>, <span class="fl">0.20</span>, <span class="fl">3.50</span>, <span class="fl">3.50</span>]}</span>
<span id="cb15-4"><a href="ip.html#cb15-4" aria-hidden="true" tabindex="-1"></a>df_to <span class="op">=</span> pd.DataFrame(data_to)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="ip.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> orthorect_param(img, df_from, df_to, PPM<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb16-2"><a href="ip.html#cb16-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3"><a href="ip.html#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># définir le valeur de float32(par point)</span></span>
<span id="cb16-4"><a href="ip.html#cb16-4" aria-hidden="true" tabindex="-1"></a>    pts1 <span class="op">=</span> np.float32(df_from.values)</span>
<span id="cb16-5"><a href="ip.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    pts2 <span class="op">=</span> np.float32(df_to.values <span class="op">*</span> PPM)</span>
<span id="cb16-6"><a href="ip.html#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="ip.html#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># définir une matrice de transformation basée sur les GCP</span></span>
<span id="cb16-8"><a href="ip.html#cb16-8" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> cv2.getPerspectiveTransform(pts1, pts2)</span>
<span id="cb16-9"><a href="ip.html#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="ip.html#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># trouver les emplacements des coins d&#39;image transformés</span></span>
<span id="cb16-11"><a href="ip.html#cb16-11" aria-hidden="true" tabindex="-1"></a>    height, width, __ <span class="op">=</span> img.shape</span>
<span id="cb16-12"><a href="ip.html#cb16-12" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> np.array([[<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb16-13"><a href="ip.html#cb16-13" aria-hidden="true" tabindex="-1"></a>                  [width, <span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb16-14"><a href="ip.html#cb16-14" aria-hidden="true" tabindex="-1"></a>                  [<span class="dv">0</span>, height, <span class="dv">1</span>],</span>
<span id="cb16-15"><a href="ip.html#cb16-15" aria-hidden="true" tabindex="-1"></a>                  [width, height, <span class="dv">1</span>]])</span>
<span id="cb16-16"><a href="ip.html#cb16-16" aria-hidden="true" tabindex="-1"></a>    C_new <span class="op">=</span> np.array([(np.dot(i, M.T) <span class="op">/</span> np.dot(i, M.T)[<span class="dv">2</span>])[:<span class="dv">2</span>] <span class="cf">for</span> i <span class="kw">in</span> C])</span>
<span id="cb16-17"><a href="ip.html#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="ip.html#cb16-18" aria-hidden="true" tabindex="-1"></a>    C_new[:, <span class="dv">0</span>] <span class="op">-=</span> <span class="bu">min</span>(C_new[:, <span class="dv">0</span>])</span>
<span id="cb16-19"><a href="ip.html#cb16-19" aria-hidden="true" tabindex="-1"></a>    C_new[:, <span class="dv">1</span>] <span class="op">-=</span> <span class="bu">min</span>(C_new[:, <span class="dv">1</span>])</span>
<span id="cb16-20"><a href="ip.html#cb16-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-21"><a href="ip.html#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># définir une nouvelle matrice de transformation basée sur les coins de l&#39;image</span></span>
<span id="cb16-22"><a href="ip.html#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sinon, une partie des images ne sera pas enregistrée</span></span>
<span id="cb16-23"><a href="ip.html#cb16-23" aria-hidden="true" tabindex="-1"></a>    M_new <span class="op">=</span> cv2.getPerspectiveTransform(np.float32(C[:,:<span class="dv">2</span>]), np.float32(C_new))</span>
<span id="cb16-24"><a href="ip.html#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="ip.html#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> M_new, C_new, df_to</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="ip.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#déterminer les paramètres d&#39;orthorectification</span></span>
<span id="cb17-2"><a href="ip.html#cb17-2" aria-hidden="true" tabindex="-1"></a>M, C, __ <span class="op">=</span> orthorect_param(corr_img, df_from, df_to, PPM<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb17-3"><a href="ip.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="ip.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># définir la taille de l&#39;image orthorectifiée</span></span>
<span id="cb17-5"><a href="ip.html#cb17-5" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> <span class="bu">int</span>(np.ceil(<span class="bu">max</span>(C[:, <span class="dv">0</span>])))</span>
<span id="cb17-6"><a href="ip.html#cb17-6" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> <span class="bu">int</span>(np.ceil(<span class="bu">max</span>(C[:, <span class="dv">1</span>])))</span>
<span id="cb17-7"><a href="ip.html#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="ip.html#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="ip.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># orthorectifier l&#39;image</span></span>
<span id="cb17-10"><a href="ip.html#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="ip.html#cb17-11" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">7</span>,<span class="dv">4</span>))</span>
<span id="cb17-12"><a href="ip.html#cb17-12" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left<span class="op">=</span><span class="dv">0</span>, bottom<span class="op">=</span><span class="dv">0</span>, right<span class="op">=</span><span class="dv">1</span>, top<span class="op">=</span><span class="dv">1</span>, wspace<span class="op">=</span><span class="fl">0.1</span>, hspace<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb17-13"><a href="ip.html#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="ip.html#cb17-14" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">111</span>)</span>
<span id="cb17-15"><a href="ip.html#cb17-15" aria-hidden="true" tabindex="-1"></a>ortho_img <span class="op">=</span> cv2.warpPerspective(img, M, (cols, rows))</span>
<span id="cb17-16"><a href="ip.html#cb17-16" aria-hidden="true" tabindex="-1"></a>plt.imshow(ortho_img[:,:,::<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb17-17"><a href="ip.html#cb17-17" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>)</span></code></pre></div>
<pre><code>## (-0.5, 2085.5, 1516.5, -0.5)</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="ip.html#cb19-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-12"></span>
<img src="PROJET_LSPIV_files/figure-html/unnamed-chunk-12-1.png" alt="L'orthorectification" width="100%"  />
<p class="caption">
Figure 5: L’orthorectification
</p>
</div>
</div>
<div id="la-mise-en-niveau-de-gris-et-la-correction-du-gamma-et-du-contraste." class="section level2 unnumbered">
<h2>La mise en niveau de gris et la correction du gamma et du contraste.</h2>
<p>La dernière étape de la préparation de l’image est la conversion du
imagerie à une échelle de gris et pour appliquer une correction de contraste et gamma.
Une mise à l’échelle des gris est nécessaire pour pouvoir appliquer la validation de similarité entre
images vidéo séquentielles. La correction de contraste et gamma est appliquée à
améliorer la visibilité des semences. Les corrections de contraste et gamma sont
appliqué à l’aide des formules suivantes:</p>
<span class="math display" id="eq:constract">\[\begin{equation}
O_{constract} = \alpha \cdot I + \beta
\tag{5}
\end{equation}\]</span>
<span class="math display" id="eq:gamma">\[\begin{equation}
O_{gamma} = \left(\frac{I}{255}\right)^\frac{1}{\gamma} \cdot 255
\tag{6}
\end{equation}\]</span>
<p>D’où <span class="math inline">\(\alpha\)</span> et <span class="math inline">\(\beta\)</span> définit la correction du contraste; <span class="math inline">\(\gamma\)</span> est la correction de gamma; <span class="math inline">\(O_n\)</span> sont les imageries corrigés; et <span class="math inline">\(I\)</span> est l’imagerie d’origine.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="ip.html#cb20-1" aria-hidden="true" tabindex="-1"></a>gamma<span class="op">=</span><span class="fl">0.4</span></span>
<span id="cb20-2"><a href="ip.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="ip.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># transformer l&#39;image en niveaux de gris</span></span>
<span id="cb20-4"><a href="ip.html#cb20-4" aria-hidden="true" tabindex="-1"></a>Grey_img <span class="op">=</span> cv2.cvtColor(ortho_img, cv2.COLOR_BGR2GRAY)</span>
<span id="cb20-5"><a href="ip.html#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="ip.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># appliquer la correction gamma</span></span>
<span id="cb20-7"><a href="ip.html#cb20-7" aria-hidden="true" tabindex="-1"></a>invGamma <span class="op">=</span> <span class="fl">1.</span><span class="op">/</span>gamma</span>
<span id="cb20-8"><a href="ip.html#cb20-8" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> (np.array([((i <span class="op">/</span> <span class="fl">255.0</span>) <span class="op">**</span> invGamma) <span class="op">*</span> <span class="dv">255</span> </span>
<span id="cb20-9"><a href="ip.html#cb20-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">0</span>, <span class="dv">256</span>)]).astype(<span class="st">&#39;uint8&#39;</span>))</span>
<span id="cb20-10"><a href="ip.html#cb20-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-11"><a href="ip.html#cb20-11" aria-hidden="true" tabindex="-1"></a>Gamma_img <span class="op">=</span> cv2.LUT(Grey_img, table)</span>
<span id="cb20-12"><a href="ip.html#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="ip.html#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="ip.html#cb20-14" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">4</span>))</span>
<span id="cb20-15"><a href="ip.html#cb20-15" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left<span class="op">=</span><span class="dv">0</span>, bottom<span class="op">=</span><span class="dv">0</span>, right<span class="op">=</span><span class="dv">1</span>, top<span class="op">=</span><span class="dv">1</span>, wspace<span class="op">=</span><span class="fl">0.1</span>, hspace<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb20-16"><a href="ip.html#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="ip.html#cb20-17" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb20-18"><a href="ip.html#cb20-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(Grey_img,cmap<span class="op">=</span><span class="st">&quot;gray&quot;</span>)</span>
<span id="cb20-19"><a href="ip.html#cb20-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;GRAY SCALE&#39;</span>)</span>
<span id="cb20-20"><a href="ip.html#cb20-20" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>) </span></code></pre></div>
<pre><code>## (-0.5, 2085.5, 1516.5, -0.5)</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="ip.html#cb22-1" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb22-2"><a href="ip.html#cb22-2" aria-hidden="true" tabindex="-1"></a>plt.imshow(Gamma_img, <span class="st">&#39;gray&#39;</span>)</span>
<span id="cb22-3"><a href="ip.html#cb22-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&#39;GAMMA&#39;</span>)</span>
<span id="cb22-4"><a href="ip.html#cb22-4" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;off&#39;</span>) </span></code></pre></div>
<pre><code>## (-0.5, 2085.5, 1516.5, -0.5)</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="ip.html#cb24-1" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-13"></span>
<img src="PROJET_LSPIV_files/figure-html/unnamed-chunk-13-1.png" alt="L'orthorectification" width="100%"  />
<p class="caption">
Figure 6: L’orthorectification
</p>
</div>
</div>
<div id="pour-tous-les-images" class="section level2 unnumbered">
<h2>Pour tous les images</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="ip.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compteur à utiliser comme nom pour les images individuelles</span></span>
<span id="cb25-2"><a href="ip.html#cb25-2" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-3"><a href="ip.html#cb25-3" aria-hidden="true" tabindex="-1"></a>gamma<span class="op">=</span><span class="fl">0.4</span></span>
<span id="cb25-4"><a href="ip.html#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="ip.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># importer une vidéo et lire chaque image individuelle (cadre)</span></span>
<span id="cb25-6"><a href="ip.html#cb25-6" aria-hidden="true" tabindex="-1"></a>cap <span class="op">=</span> cv2.VideoCapture(dir_video)</span>
<span id="cb25-7"><a href="ip.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> cap.isOpened():</span>
<span id="cb25-8"><a href="ip.html#cb25-8" aria-hidden="true" tabindex="-1"></a>    ret, img <span class="op">=</span> cap.read()</span>
<span id="cb25-9"><a href="ip.html#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ret:</span>
<span id="cb25-10"><a href="ip.html#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="ip.html#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># appliquer la correction de la distorsion de l&#39;objectif</span></span>
<span id="cb25-12"><a href="ip.html#cb25-12" aria-hidden="true" tabindex="-1"></a>        img_dist <span class="op">=</span> lens_corr(img, k1<span class="op">=-</span><span class="fl">10.0e-6</span>, c<span class="op">=</span><span class="dv">2</span>, f<span class="op">=</span><span class="fl">8.0</span>)</span>
<span id="cb25-13"><a href="ip.html#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="ip.html#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># appliquer une orthorectification</span></span>
<span id="cb25-15"><a href="ip.html#cb25-15" aria-hidden="true" tabindex="-1"></a>        img_orth <span class="op">=</span> cv2.warpPerspective(img_dist, M, (cols, rows))</span>
<span id="cb25-16"><a href="ip.html#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="ip.html#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># appliquer une échelle de gris, une correction du contraste et du gamma</span></span>
<span id="cb25-18"><a href="ip.html#cb25-18" aria-hidden="true" tabindex="-1"></a>        img_grey <span class="op">=</span> cv2.cvtColor(img_orth, cv2.COLOR_BGR2GRAY)</span>
<span id="cb25-19"><a href="ip.html#cb25-19" aria-hidden="true" tabindex="-1"></a>        Gamma_img <span class="op">=</span> cv2.LUT(img_grey, table)</span>
<span id="cb25-20"><a href="ip.html#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="ip.html#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># rogner l&#39;image à une taille plus raisonnable en excluant les limites extérieures</span></span>
<span id="cb25-22"><a href="ip.html#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># l&#39;image pourrait être recadrée dans l&#39;étendue de la zone d&#39;intérêt</span></span>
<span id="cb25-23"><a href="ip.html#cb25-23" aria-hidden="true" tabindex="-1"></a>        img_out <span class="op">=</span> Gamma_img[<span class="bu">max</span>(<span class="dv">0</span>, rows<span class="op">-</span><span class="dv">1000</span>):, :<span class="bu">min</span>(<span class="dv">2000</span>, cols)]</span>
<span id="cb25-24"><a href="ip.html#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="ip.html#cb25-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># enregistrez l&#39;image avec le nom &#39;n&#39;</span></span>
<span id="cb25-26"><a href="ip.html#cb25-26" aria-hidden="true" tabindex="-1"></a>        framename <span class="op">=</span> os.path.join(dir_saves,</span>
<span id="cb25-27"><a href="ip.html#cb25-27" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&#39;frame_&#39;</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">format</span>(n).zfill(<span class="dv">6</span>))<span class="op">+</span><span class="st">&#39;.jpg&#39;</span>)</span>
<span id="cb25-28"><a href="ip.html#cb25-28" aria-hidden="true" tabindex="-1"></a>        cv2.imwrite(framename, img_out)</span>
<span id="cb25-29"><a href="ip.html#cb25-29" aria-hidden="true" tabindex="-1"></a>        n <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb25-30"><a href="ip.html#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-31"><a href="ip.html#cb25-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb25-32"><a href="ip.html#cb25-32" aria-hidden="true" tabindex="-1"></a>cap.release()</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="piv.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "White",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["PROJET_LSPIV.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
},
"search": true,
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
